import{_ as X}from"./@babel-34ca84e8.js";import{r as d}from"./react-dab3e289.js";import{L as Se,T as Ft,R as zt,U as It,s as lt,a as Wt,O as $e,P as Be,S as Ke,b as Oe,B as Ht,M as $t,C as Bt,V as G,c as Nt,W as Ut,d as Gt,e as qt,f as Vt,g as Xt,h as Yt,N as Zt,A as Kt,i as Jt,j as Qt,D as en,k as we,l as Ne,m as tn,E as ct,n as nn,o as rn,p as on,q as ce,r as sn,t as an,u as ln}from"./three-891170d2.js";import{u as cn}from"./react-use-measure-1e0236bf.js";import{F as un,u as fn}from"./its-fine-0502800c.js";import{R as dn,c as le}from"./react-reconciler-abdce316.js";import{c as pn}from"./react-dom-38080391.js";import{c as ut}from"./zustand-9be6e683.js";import"./maath-01ed86e0.js";import{D as mn,G as Ue,a as vn,M as Re,O as hn}from"./three-stdlib-02a433b1.js";import{m as Ge}from"./react-merge-refs-239dbb3c.js";import{s as gn,p as yn,c as bn}from"./suspend-react-00b64780.js";var Me={},wn={get exports(){return Me},set exports(e){Me=e}},ft={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(w,C){var x=w.length;w.push(C);e:for(;0<x;){var R=x-1>>>1,O=w[R];if(0<a(O,C))w[R]=C,w[x]=O,x=R;else break e}}function n(w){return w.length===0?null:w[0]}function i(w){if(w.length===0)return null;var C=w[0],x=w.pop();if(x!==C){w[0]=x;e:for(var R=0,O=w.length,H=O>>>1;R<H;){var L=2*(R+1)-1,V=w[L],B=L+1,re=w[B];if(0>a(V,x))B<O&&0>a(re,V)?(w[R]=re,w[B]=x,R=B):(w[R]=V,w[L]=x,R=L);else if(B<O&&0>a(re,x))w[R]=re,w[B]=x,R=B;else break e}}return C}function a(w,C){var x=w.sortIndex-C.sortIndex;return x!==0?x:w.id-C.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var h=Date,g=h.now();e.unstable_now=function(){return h.now()-g}}var s=[],v=[],o=1,r=null,u=3,f=!1,m=!1,E=!1,y=typeof setTimeout=="function"?setTimeout:null,c=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(w){for(var C=n(v);C!==null;){if(C.callback===null)i(v);else if(C.startTime<=w)i(v),C.sortIndex=C.expirationTime,t(s,C);else break;C=n(v)}}function P(w){if(E=!1,b(w),!m)if(n(s)!==null)m=!0,q(M);else{var C=n(v);C!==null&&F(P,C.startTime-w)}}function M(w,C){m=!1,E&&(E=!1,c(A),A=-1),f=!0;var x=u;try{for(b(C),r=n(s);r!==null&&(!(r.expirationTime>C)||w&&!_());){var R=r.callback;if(typeof R=="function"){r.callback=null,u=r.priorityLevel;var O=R(r.expirationTime<=C);C=e.unstable_now(),typeof O=="function"?r.callback=O:r===n(s)&&i(s),b(C)}else i(s);r=n(s)}if(r!==null)var H=!0;else{var L=n(v);L!==null&&F(P,L.startTime-C),H=!1}return H}finally{r=null,u=x,f=!1}}var S=!1,k=null,A=-1,j=5,D=-1;function _(){return!(e.unstable_now()-D<j)}function T(){if(k!==null){var w=e.unstable_now();D=w;var C=!0;try{C=k(!0,w)}finally{C?$():(S=!1,k=null)}}else S=!1}var $;if(typeof p=="function")$=function(){p(T)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,W=Y.port2;Y.port1.onmessage=T,$=function(){W.postMessage(null)}}else $=function(){y(T,0)};function q(w){k=w,S||(S=!0,$())}function F(w,C){A=y(function(){w(e.unstable_now())},C)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(w){w.callback=null},e.unstable_continueExecution=function(){m||f||(m=!0,q(M))},e.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<w?Math.floor(1e3/w):5},e.unstable_getCurrentPriorityLevel=function(){return u},e.unstable_getFirstCallbackNode=function(){return n(s)},e.unstable_next=function(w){switch(u){case 1:case 2:case 3:var C=3;break;default:C=u}var x=u;u=C;try{return w()}finally{u=x}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(w,C){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var x=u;u=w;try{return C()}finally{u=x}},e.unstable_scheduleCallback=function(w,C,x){var R=e.unstable_now();switch(typeof x=="object"&&x!==null?(x=x.delay,x=typeof x=="number"&&0<x?R+x:R):x=R,w){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=x+O,w={id:o++,callback:C,priorityLevel:w,startTime:x,expirationTime:O,sortIndex:-1},x>R?(w.sortIndex=x,t(v,w),n(s)===null&&w===n(v)&&(E?(c(A),A=-1):E=!0,F(P,x-R))):(w.sortIndex=O,t(s,w),m||f||(m=!0,q(M))),w},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(w){var C=u;return function(){var x=u;u=C;try{return w.apply(this,arguments)}finally{u=x}}}})(ft);(function(e){e.exports=ft})(wn);const qe={},_n=e=>void Object.assign(qe,e);function En(e,t){function n(o,{args:r=[],attach:u,...f},m){let E=`${o[0].toUpperCase()}${o.slice(1)}`,y;if(o==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const c=f.object;y=se(c,{type:o,root:m,attach:u,primitive:!0})}else{const c=qe[E];if(!c)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");y=se(new c(...r),{type:o,root:m,attach:u,memoizedProps:{args:r}})}return y.__r3f.attach===void 0&&(y instanceof Ht?y.__r3f.attach="geometry":y instanceof $t&&(y.__r3f.attach="material")),E!=="inject"&&Ae(y,f),y}function i(o,r){let u=!1;if(r){var f,m;(f=r.__r3f)!=null&&f.attach?je(o,r,r.__r3f.attach):r.isObject3D&&o.isObject3D&&(o.add(r),u=!0),u||(m=o.__r3f)==null||m.objects.push(r),r.__r3f||se(r,{}),r.__r3f.parent=o,We(r),ae(r)}}function a(o,r,u){let f=!1;if(r){var m,E;if((m=r.__r3f)!=null&&m.attach)je(o,r,r.__r3f.attach);else if(r.isObject3D&&o.isObject3D){r.parent=o,r.dispatchEvent({type:"added"});const y=o.children.filter(p=>p!==r),c=y.indexOf(u);o.children=[...y.slice(0,c),r,...y.slice(c)],f=!0}f||(E=o.__r3f)==null||E.objects.push(r),r.__r3f||se(r,{}),r.__r3f.parent=o,We(r),ae(r)}}function l(o,r,u=!1){o&&[...o].forEach(f=>h(r,f,u))}function h(o,r,u){if(r){var f,m,E;if(r.__r3f&&(r.__r3f.parent=null),(f=o.__r3f)!=null&&f.objects&&(o.__r3f.objects=o.__r3f.objects.filter(P=>P!==r)),(m=r.__r3f)!=null&&m.attach)nt(o,r,r.__r3f.attach);else if(r.isObject3D&&o.isObject3D){var y;o.remove(r),(y=r.__r3f)!=null&&y.root&&jn(r.__r3f.root,r)}const p=(E=r.__r3f)==null?void 0:E.primitive,b=u===void 0?r.dispose!==null&&!p:u;if(!p){var c;l((c=r.__r3f)==null?void 0:c.objects,r,b),l(r.children,r,b)}r.__r3f&&(delete r.__r3f.root,delete r.__r3f.objects,delete r.__r3f.handlers,delete r.__r3f.memoizedProps,p||delete r.__r3f),b&&r.dispose&&r.type!=="Scene"&&Me.unstable_scheduleCallback(Me.unstable_IdlePriority,()=>{try{r.dispose()}catch{}}),ae(o)}}function g(o,r,u,f){var m;const E=(m=o.__r3f)==null?void 0:m.parent;if(!E)return;const y=n(r,u,o.__r3f.root);if(o.children){for(const c of o.children)c.__r3f&&i(y,c);o.children=o.children.filter(c=>!c.__r3f)}o.__r3f.objects.forEach(c=>i(y,c)),o.__r3f.objects=[],o.__r3f.autoRemovedBeforeAppend||h(E,o),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(E,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[f,f.alternate].forEach(c=>{c!==null&&(c.stateNode=y,c.ref&&(typeof c.ref=="function"?c.ref(y):c.ref.current=y))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:dn({createInstance:n,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(o,r)=>{if(!r)return;const u=o.getState().scene;u.__r3f&&(u.__r3f.root=o,i(u,r))},removeChildFromContainer:(o,r)=>{r&&h(o.getState().scene,r)},insertInContainerBefore:(o,r,u)=>{if(!r||!u)return;const f=o.getState().scene;f.__r3f&&a(f,r,u)},getRootHostContext:()=>null,getChildHostContext:o=>o,finalizeInitialChildren(o){var r;return!!((r=o==null?void 0:o.__r3f)!=null?r:{}).handlers},prepareUpdate(o,r,u,f){if(o.__r3f.primitive&&f.object&&f.object!==o)return[!0];{const{args:m=[],children:E,...y}=f,{args:c=[],children:p,...b}=u;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((M,S)=>M!==c[S]))return[!0];const P=yt(o,y,b,!0);return P.changes.length?[!1,P]:null}},commitUpdate(o,[r,u],f,m,E,y){r?g(o,f,E,y):Ae(o,u)},commitMount(o,r,u,f){var m;const E=(m=o.__r3f)!=null?m:{};o.raycast&&E.handlers&&E.eventCount&&o.__r3f.root.getState().internal.interaction.push(o)},getPublicInstance:o=>o,prepareForCommit:()=>null,preparePortalMount:o=>se(o.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(o){var r;const{attach:u,parent:f}=(r=o.__r3f)!=null?r:{};u&&f&&nt(f,o,u),o.isObject3D&&(o.visible=!1),ae(o)},unhideInstance(o,r){var u;const{attach:f,parent:m}=(u=o.__r3f)!=null?u:{};f&&m&&je(m,o,f),(o.isObject3D&&r.visible==null||r.visible)&&(o.visible=!0),ae(o)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():le.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var Je,Qe;const dt=()=>{var e;return(e=qe.ColorManagement)!=null?e:null},pt=e=>e&&e.isOrthographicCamera,Pn=e=>e&&e.hasOwnProperty("current"),he=typeof window<"u"&&((Je=window.document)!=null&&Je.createElement||((Qe=window.navigator)==null?void 0:Qe.product)==="ReactNative")?d.useLayoutEffect:d.useEffect;function mt(e){const t=d.useRef(e);return he(()=>void(t.current=e),[e]),t}function Mn({set:e}){return he(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class vt extends d.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}vt.getDerivedStateFromError=()=>({error:!0});const ht="__default",et=new Map,xn=e=>e&&!!e.memoized&&!!e.changes;function gt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const de=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const l=I.obj(e);if(l&&i==="reference")return e===t;const h=I.arr(e);if(h&&n==="reference")return e===t;if((h||l)&&e===t)return!0;let g;for(g in e)if(!(g in t))return!1;if(l&&n==="shallow"&&i==="shallow"){for(g in a?t:e)if(!I.equ(e[g],t[g],{strict:a,objects:"reference"}))return!1}else for(g in a?t:e)if(e[g]!==t[g])return!1;if(I.und(g)){if(h&&e.length===0&&t.length===0||l&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Cn(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function Sn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function se(e,t){const n=e;return(t!=null&&t.primitive||!n.__r3f)&&(n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function Ie(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return n=i.reduce((l,h)=>l[h],e),{target:n,key:a}}else return{target:n,key:t}}const tt=/-\d+$/;function je(e,t,n){if(I.str(n)){if(tt.test(n)){const l=n.replace(tt,""),{target:h,key:g}=Ie(e,l);Array.isArray(h[g])||(h[g]=[])}const{target:i,key:a}=Ie(e,n);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=n(e,t)}function nt(e,t,n){var i,a;if(I.str(n)){const{target:l,key:h}=Ie(e,n),g=t.__r3f.previousAttach;g===void 0?delete l[h]:l[h]=g}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function yt(e,{children:t,key:n,ref:i,...a},{children:l,key:h,ref:g,...s}={},v=!1){var o;const r=(o=e==null?void 0:e.__r3f)!=null?o:{},u=Object.entries(a),f=[];if(v){const E=Object.keys(s);for(let y=0;y<E.length;y++)a.hasOwnProperty(E[y])||u.unshift([E[y],ht+"remove"])}u.forEach(([E,y])=>{var c;if((c=e.__r3f)!=null&&c.primitive&&E==="object"||I.equ(y,s[E]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(E))return f.push([E,y,!0,[]]);let p=[];E.includes("-")&&(p=E.split("-")),f.push([E,y,!1,p]);for(const b in a){const P=a[b];b.startsWith(`${E}-`)&&f.push([b,P,!1,b.split("-")])}});const m={...a};return r.memoizedProps&&r.memoizedProps.args&&(m.args=r.memoizedProps.args),r.memoizedProps&&r.memoizedProps.attach&&(m.attach=r.memoizedProps.attach),{memoized:m,changes:f}}function Ae(e,t){var n,i,a;const l=(n=e.__r3f)!=null?n:{},h=l.root,g=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:s,changes:v}=xn(t)?t:yt(e,t),o=l.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let u=0;u<v.length;u++){let[f,m,E,y]=v[u],c=e,p=c[f];if(y.length&&(p=y.reduce((b,P)=>b[P],e),!(p&&p.set))){const[b,...P]=y.reverse();c=P.reverse().reduce((M,S)=>M[S],e),f=b}if(m===ht+"remove")if(c.constructor){let b=et.get(c.constructor);b||(b=new c.constructor,et.set(c.constructor,b)),m=b[f]}else m=0;if(E)m?l.handlers[f]=m:delete l.handlers[f],l.eventCount=Object.keys(l.handlers).length;else if(p&&p.set&&(p.copy||p instanceof Se)){if(Array.isArray(m))p.fromArray?p.fromArray(m):p.set(...m);else if(p.copy&&m&&m.constructor&&p.constructor===m.constructor)p.copy(m);else if(m!==void 0){const b=p instanceof Bt;!b&&p.setScalar?p.setScalar(m):p instanceof Se&&m instanceof Se?p.mask=m.mask:p.set(m),!dt()&&!g.linear&&b&&p.convertSRGBToLinear()}}else c[f]=m,!g.linear&&c[f]instanceof Ft&&c[f].format===zt&&c[f].type===It&&(c[f].encoding=lt);ae(e)}if(l.parent&&g.internal&&e.raycast&&o!==l.eventCount){const u=g.internal.interaction.indexOf(e);u>-1&&g.internal.interaction.splice(u,1),l.eventCount&&g.internal.interaction.push(e)}return!(v.length===1&&v[0][0]==="onUpdate")&&v.length&&(a=e.__r3f)!=null&&a.parent&&We(e),e}function ae(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function We(e){e.onUpdate==null||e.onUpdate(e)}function On(e,t){e.manual||(pt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function _e(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Rn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return le.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return le.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return le.ContinuousEventPriority;default:return le.DefaultEventPriority}}function bt(e,t,n,i){const a=n.get(t);a&&(n.delete(t),n.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function jn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(a)}),n.capturedMap.forEach((i,a)=>{bt(n.capturedMap,t,i,a)})}function An(e){function t(s){const{internal:v}=e.getState(),o=s.offsetX-v.initialClick[0],r=s.offsetY-v.initialClick[1];return Math.round(Math.sqrt(o*o+r*r))}function n(s){return s.filter(v=>["Move","Over","Enter","Out","Leave"].some(o=>{var r;return(r=v.__r3f)==null?void 0:r.handlers["onPointer"+o]}))}function i(s,v){const o=e.getState(),r=new Set,u=[],f=v?v(o.internal.interaction):o.internal.interaction;for(let c=0;c<f.length;c++){const p=de(f[c]);p&&(p.raycaster.camera=void 0)}o.previousRoot||o.events.compute==null||o.events.compute(s,o);function m(c){const p=de(c);if(!p||!p.events.enabled||p.raycaster.camera===null)return[];if(p.raycaster.camera===void 0){var b;p.events.compute==null||p.events.compute(s,p,(b=p.previousRoot)==null?void 0:b.getState()),p.raycaster.camera===void 0&&(p.raycaster.camera=null)}return p.raycaster.camera?p.raycaster.intersectObject(c,!0):[]}let E=f.flatMap(m).sort((c,p)=>{const b=de(c.object),P=de(p.object);return!b||!P?c.distance-p.distance:P.events.priority-b.events.priority||c.distance-p.distance}).filter(c=>{const p=_e(c);return r.has(p)?!1:(r.add(p),!0)});o.events.filter&&(E=o.events.filter(E,o));for(const c of E){let p=c.object;for(;p;){var y;(y=p.__r3f)!=null&&y.eventCount&&u.push({...c,eventObject:p}),p=p.parent}}if("pointerId"in s&&o.internal.capturedMap.has(s.pointerId))for(let c of o.internal.capturedMap.get(s.pointerId).values())r.has(_e(c.intersection))||u.push(c.intersection);return u}function a(s,v,o,r){const u=e.getState();if(s.length){const f={stopped:!1};for(const m of s){const E=de(m.object)||u,{raycaster:y,pointer:c,camera:p,internal:b}=E,P=new G(c.x,c.y,0).unproject(p),M=D=>{var _,T;return(_=(T=b.capturedMap.get(D))==null?void 0:T.has(m.eventObject))!=null?_:!1},S=D=>{const _={intersection:m,target:v.target};b.capturedMap.has(D)?b.capturedMap.get(D).set(m.eventObject,_):b.capturedMap.set(D,new Map([[m.eventObject,_]])),v.target.setPointerCapture(D)},k=D=>{const _=b.capturedMap.get(D);_&&bt(b.capturedMap,m.eventObject,_,D)};let A={};for(let D in v){let _=v[D];typeof _!="function"&&(A[D]=_)}let j={...m,...A,pointer:c,intersections:s,stopped:f.stopped,delta:o,unprojectedPoint:P,ray:y.ray,camera:p,stopPropagation(){const D="pointerId"in v&&b.capturedMap.get(v.pointerId);if((!D||D.has(m.eventObject))&&(j.stopped=f.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(_=>_.eventObject===m.eventObject))){const _=s.slice(0,s.indexOf(m));l([..._,m])}},target:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:k},currentTarget:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:k},nativeEvent:v};if(r(j),f.stopped===!0)break}}return s}function l(s){const{internal:v}=e.getState();for(const o of v.hovered.values())if(!s.length||!s.find(r=>r.object===o.object&&r.index===o.index&&r.instanceId===o.instanceId)){const u=o.eventObject.__r3f,f=u==null?void 0:u.handlers;if(v.hovered.delete(_e(o)),u!=null&&u.eventCount){const m={...o,intersections:s};f.onPointerOut==null||f.onPointerOut(m),f.onPointerLeave==null||f.onPointerLeave(m)}}}function h(s,v){for(let o=0;o<v.length;o++){const r=v[o].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(s)}}function g(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return v=>{const{internal:o}=e.getState();"pointerId"in v&&o.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{o.capturedMap.has(v.pointerId)&&(o.capturedMap.delete(v.pointerId),l([]))})}}return function(o){const{onPointerMissed:r,internal:u}=e.getState();u.lastEvent.current=o;const f=s==="onPointerMove",m=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",y=i(o,f?n:void 0),c=m?t(o):0;s==="onPointerDown"&&(u.initialClick=[o.offsetX,o.offsetY],u.initialHits=y.map(b=>b.eventObject)),m&&!y.length&&c<=2&&(h(o,u.interaction),r&&r(o)),f&&l(y);function p(b){const P=b.eventObject,M=P.__r3f,S=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(f){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const k=_e(b),A=u.hovered.get(k);A?A.stopped&&b.stopPropagation():(u.hovered.set(k,b),S.onPointerOver==null||S.onPointerOver(b),S.onPointerEnter==null||S.onPointerEnter(b))}S.onPointerMove==null||S.onPointerMove(b)}else{const k=S[s];k?(!m||u.initialHits.includes(P))&&(h(o,u.interaction.filter(A=>!u.initialHits.includes(A))),k(b)):m&&u.initialHits.includes(P)&&h(o,u.interaction.filter(A=>!u.initialHits.includes(A)))}}a(y,o,c,p)}}return{handlePointer:g}}const wt=e=>!!(e!=null&&e.render),_t=d.createContext(null),Tn=(e,t)=>{const n=ut((g,s)=>{const v=new G,o=new G,r=new G;function u(c=s().camera,p=o,b=s().size){const{width:P,height:M,top:S,left:k}=b,A=P/M;p instanceof G?r.copy(p):r.set(...p);const j=c.getWorldPosition(v).distanceTo(r);if(pt(c))return{width:P/c.zoom,height:M/c.zoom,top:S,left:k,factor:1,distance:j,aspect:A};{const D=c.fov*Math.PI/180,_=2*Math.tan(D/2)*j,T=_*(P/M);return{width:T,height:_,top:S,left:k,factor:P/T,distance:j,aspect:A}}}let f;const m=c=>g(p=>({performance:{...p.performance,current:c}})),E=new Nt;return{set:g,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(c=1)=>e(s(),c),advance:(c,p)=>t(c,p,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Jt,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const c=s();f&&clearTimeout(f),c.performance.current!==c.performance.min&&m(c.performance.min),f=setTimeout(()=>m(s().performance.max),c.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:c=>g(p=>({...p,events:{...p.events,...c}})),setSize:(c,p,b,P,M)=>{const S=s().camera,k={width:c,height:p,top:P||0,left:M||0,updateStyle:b};g(A=>({size:k,viewport:{...A.viewport,...u(S,o,k)}}))},setDpr:c=>g(p=>{const b=gt(c);return{viewport:{...p.viewport,dpr:b,initialDpr:p.viewport.initialDpr||b}}}),setFrameloop:(c="always")=>{const p=s().clock;p.stop(),p.elapsedTime=0,c!=="never"&&(p.start(),p.elapsedTime=0),g(()=>({frameloop:c}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:d.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(c,p,b)=>{const P=s().internal;return P.priority=P.priority+(p>0?1:0),P.subscribers.push({ref:c,priority:p,store:b}),P.subscribers=P.subscribers.sort((M,S)=>M.priority-S.priority),()=>{const M=s().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(p>0?1:0),M.subscribers=M.subscribers.filter(S=>S.ref!==c))}}}}}),i=n.getState();let a=i.size,l=i.viewport.dpr,h=i.camera;return n.subscribe(()=>{const{camera:g,size:s,viewport:v,gl:o,set:r}=n.getState();if(s!==a||v.dpr!==l){var u;a=s,l=v.dpr,On(g,s),o.setPixelRatio(v.dpr);const f=(u=s.updateStyle)!=null?u:typeof HTMLCanvasElement<"u"&&o.domElement instanceof HTMLCanvasElement;o.setSize(s.width,s.height,f)}g!==h&&(h=g,r(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(g)}})))}),n.subscribe(g=>e(g)),n};let Ee,kn=new Set,Dn=new Set,Ln=new Set;function Te(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function pe(e,t){switch(e){case"before":return Te(kn,t);case"after":return Te(Dn,t);case"tail":return Te(Ln,t)}}let ke,De;function Le(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ke=t.internal.subscribers,Ee=0;Ee<ke.length;Ee++)De=ke[Ee],De.ref.current(De.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Fn(e){let t=!1,n,i,a;function l(s){i=requestAnimationFrame(l),t=!0,n=0,pe("before",s);for(const o of e.values()){var v;a=o.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((v=a.gl.xr)!=null&&v.isPresenting)&&(n+=Le(s,a))}if(pe("after",s),n===0)return pe("tail",s),t=!1,cancelAnimationFrame(i)}function h(s,v=1){var o;if(!s)return e.forEach(r=>h(r.store.getState()),v);(o=s.gl.xr)!=null&&o.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+v),t||(t=!0,requestAnimationFrame(l)))}function g(s,v=!0,o,r){if(v&&pe("before",s),o)Le(s,o,r);else for(const u of e.values())Le(s,u.store.getState());v&&pe("after",s)}return{loop:l,invalidate:h,advance:g}}function Et(){const e=d.useContext(_t);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function U(e=n=>n,t){return Et()(e,t)}function ge(e,t=0){const n=Et(),i=n.getState().internal.subscribe,a=mt(e);return he(()=>i(a,t,n),[t,i,n]),null}function Pt(e,t){return function(n,...i){const a=new n;return e&&e(a),Promise.all(i.map(l=>new Promise((h,g)=>a.load(l,s=>{s.scene&&Object.assign(s,Cn(s.scene)),h(s)},t,s=>g(new Error(`Could not load ${l}: ${s.message})`))))))}}function J(e,t,n,i){const a=Array.isArray(t)?t:[t],l=gn(Pt(n,i),[e,...a],{equal:I.equ});return Array.isArray(t)?l:l[0]}J.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return yn(Pt(n),[e,...i])};J.clear=function(e,t){const n=Array.isArray(t)?t:[t];return bn([e,...n])};const ue=new Map,{invalidate:rt,advance:ot}=Fn(ue),{reconciler:xe,applyProps:K}=En(ue,Rn),ie={objects:"shallow",strict:!1},zn=(e,t)=>{const n=typeof e=="function"?e(t):e;return wt(n)?n:new Ut({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function In(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:i,top:a,left:l}=e.parentElement.getBoundingClientRect();return{width:n,height:i,top:a,left:l}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Wn(e){const t=ue.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,l=i||Tn(rt,ot),h=n||xe.createContainer(l,le.ConcurrentRoot,null,!1,null,"",a,null);t||ue.set(e,{fiber:h,store:l});let g,s=!1,v;return{configure(o={}){let{gl:r,size:u,scene:f,events:m,onCreated:E,shadows:y=!1,linear:c=!1,flat:p=!1,legacy:b=!1,orthographic:P=!1,frameloop:M="always",dpr:S=[1,2],performance:k,raycaster:A,camera:j,onPointerMissed:D}=o,_=l.getState(),T=_.gl;_.gl||_.set({gl:T=zn(r,e)});let $=_.raycaster;$||_.set({raycaster:$=new Wt});const{params:Y,...W}=A||{};if(I.equ(W,$,ie)||K($,{...W}),I.equ(Y,$.params,ie)||K($,{params:{...$.params,...Y}}),!_.camera||_.camera===v&&!I.equ(v,j,ie)){v=j;const R=j instanceof Gt,O=R?j:P?new $e(0,0,0,0,.1,1e3):new Be(75,0,.1,1e3);R||(O.position.z=5,j&&K(O,j),!_.camera&&!(j!=null&&j.rotation)&&O.lookAt(0,0,0)),_.set({camera:O})}if(!_.scene){let R;f instanceof Ke?R=f:(R=new Ke,f&&K(R,f)),_.set({scene:se(R)})}if(!_.xr){const R=(L,V)=>{const B=l.getState();B.frameloop!=="never"&&ot(L,!0,B,V)},O=()=>{const L=l.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?R:null),L.gl.xr.isPresenting||rt(L)},H={connect(){const L=l.getState().gl;L.xr.addEventListener("sessionstart",O),L.xr.addEventListener("sessionend",O)},disconnect(){const L=l.getState().gl;L.xr.removeEventListener("sessionstart",O),L.xr.removeEventListener("sessionend",O)}};T.xr&&H.connect(),_.set({xr:H})}if(T.shadowMap){const R=T.shadowMap.enabled,O=T.shadowMap.type;if(T.shadowMap.enabled=!!y,I.boo(y))T.shadowMap.type=Oe;else if(I.str(y)){var q;const H={basic:qt,percentage:Vt,soft:Oe,variance:Xt};T.shadowMap.type=(q=H[y])!=null?q:Oe}else I.obj(y)&&Object.assign(T.shadowMap,y);(R!==T.shadowMap.enabled||O!==T.shadowMap.type)&&(T.shadowMap.needsUpdate=!0)}const F=dt();F&&("enabled"in F?F.enabled=!b:"legacyMode"in F&&(F.legacyMode=b));const w=c?Yt:lt,C=p?Zt:Kt;T.outputEncoding!==w&&(T.outputEncoding=w),T.toneMapping!==C&&(T.toneMapping=C),_.legacy!==b&&_.set(()=>({legacy:b})),_.linear!==c&&_.set(()=>({linear:c})),_.flat!==p&&_.set(()=>({flat:p})),r&&!I.fun(r)&&!wt(r)&&!I.equ(r,T,ie)&&K(T,r),m&&!_.events.handlers&&_.set({events:m(l)});const x=In(e,u);return I.equ(x,_.size,ie)||_.setSize(x.width,x.height,x.updateStyle,x.top,x.left),S&&_.viewport.dpr!==gt(S)&&_.setDpr(S),_.frameloop!==M&&_.setFrameloop(M),_.onPointerMissed||_.set({onPointerMissed:D}),k&&!I.equ(k,_.performance,ie)&&_.set(R=>({performance:{...R.performance,...k}})),g=E,s=!0,this},render(o){return s||this.configure(),xe.updateContainer(d.createElement(Hn,{store:l,children:o,onCreated:g,rootElement:e}),h,null,()=>{}),l},unmount(){Mt(e)}}}function Hn({store:e,children:t,onCreated:n,rootElement:i}){return he(()=>{const a=e.getState();a.set(l=>({internal:{...l.internal,active:!0}})),n&&n(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),d.createElement(_t.Provider,{value:e},t)}function Mt(e,t){const n=ue.get(e),i=n==null?void 0:n.fiber;if(i){const a=n==null?void 0:n.store.getState();a&&(a.internal.active=!1),xe.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var l,h,g,s;a.events.disconnect==null||a.events.disconnect(),(l=a.gl)==null||(h=l.renderLists)==null||h.dispose==null||h.dispose(),(g=a.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(s=a.gl)!=null&&s.xr&&a.xr.disconnect(),Sn(a),ue.delete(e),t&&t(e)}catch{}},500)})}}xe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:d.version});const Fe={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function $n(e){const{handlePointer:t}=An(e);return{priority:1,enabled:!0,compute(n,i,a){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Fe).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:a}=e.getState();(n=a.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:n=>{var i;const{set:a,events:l}=e.getState();l.disconnect==null||l.disconnect(),a(h=>({events:{...h.events,connected:n}})),Object.entries((i=l.handlers)!=null?i:[]).forEach(([h,g])=>{const[s,v]=Fe[h];n.addEventListener(s,g,{passive:v})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([l,h])=>{if(i&&i.connected instanceof HTMLElement){const[g]=Fe[l];i.connected.removeEventListener(g,h)}}),n(l=>({events:{...l.events,connected:void 0}}))}}}}const Bn=d.forwardRef(function({children:t,fallback:n,resize:i,style:a,gl:l,events:h=$n,eventSource:g,eventPrefix:s,shadows:v,linear:o,flat:r,legacy:u,orthographic:f,frameloop:m,dpr:E,performance:y,raycaster:c,camera:p,onPointerMissed:b,onCreated:P,...M},S){d.useMemo(()=>_n(Qt),[]);const k=fn(),[A,j]=cn({scroll:!0,debounce:{scroll:50,resize:0},...i}),D=d.useRef(null),_=d.useRef(null);d.useImperativeHandle(S,()=>D.current);const T=mt(b),[$,Y]=d.useState(!1),[W,q]=d.useState(!1);if($)throw $;if(W)throw W;const F=d.useRef(null);he(()=>{const C=D.current;j.width>0&&j.height>0&&C&&(F.current||(F.current=Wn(C)),F.current.configure({gl:l,events:h,shadows:v,linear:o,flat:r,legacy:u,orthographic:f,frameloop:m,dpr:E,performance:y,raycaster:c,camera:p,size:j,onPointerMissed:(...x)=>T.current==null?void 0:T.current(...x),onCreated:x=>{x.events.connect==null||x.events.connect(g?Pn(g)?g.current:g:_.current),s&&x.setEvents({compute:(R,O)=>{const H=R[s+"X"],L=R[s+"Y"];O.pointer.set(H/O.size.width*2-1,-(L/O.size.height)*2+1),O.raycaster.setFromCamera(O.pointer,O.camera)}}),P==null||P(x)}}),F.current.render(d.createElement(k,null,d.createElement(vt,{set:q},d.createElement(d.Suspense,{fallback:d.createElement(Mn,{set:Y})},t)))))}),d.useEffect(()=>{const C=D.current;if(C)return()=>Mt(C)},[]);const w=g?"none":"auto";return d.createElement("div",X({ref:_,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:w,...a}},M),d.createElement("div",{ref:A,style:{width:"100%",height:"100%"}},d.createElement("canvas",{ref:D,style:{display:"block"}},n)))}),vr=d.forwardRef(function(t,n){return d.createElement(un,null,d.createElement(Bn,X({},t,{ref:n})))}),ye=new G,Ve=new G,Nn=new G;function Un(e,t,n){const i=ye.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=n.width/2,l=n.height/2;return[i.x*a+a,-(i.y*l)+l]}function Gn(e,t){const n=ye.setFromMatrixPosition(e.matrixWorld),i=Ve.setFromMatrixPosition(t.matrixWorld),a=n.sub(i),l=t.getWorldDirection(Nn);return a.angleTo(l)>Math.PI/2}function qn(e,t,n,i){const a=ye.setFromMatrixPosition(e.matrixWorld),l=a.clone();l.project(t),n.setFromCamera(l,t);const h=n.intersectObjects(i,!0);if(h.length){const g=h[0].distance;return a.distanceTo(n.ray.origin)<g}return!0}function Vn(e,t){if(t instanceof $e)return t.zoom;if(t instanceof Be){const n=ye.setFromMatrixPosition(e.matrixWorld),i=Ve.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,l=n.distanceTo(i);return 1/(2*Math.tan(a/2)*l)}else return 1}function Xn(e,t,n){if(t instanceof Be||t instanceof $e){const i=ye.setFromMatrixPosition(e.matrixWorld),a=Ve.setFromMatrixPosition(t.matrixWorld),l=i.distanceTo(a),h=(n[1]-n[0])/(t.far-t.near),g=n[1]-h*t.far;return Math.round(h*l+g)}}const He=e=>Math.abs(e)<1e-10?0:e;function xt(e,t,n=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=He(t[a]*e.elements[a])+(a!==15?",":")");return n+i}const Yn=(e=>t=>xt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Zn=(e=>(t,n)=>xt(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Kn(e){return e&&typeof e=="object"&&"current"in e}const hr=d.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:a,center:l,fullscreen:h,portal:g,distanceFactor:s,sprite:v=!1,transform:o=!1,occlude:r,onOcclude:u,castShadow:f,receiveShadow:m,material:E,geometry:y,zIndexRange:c=[16777271,0],calculatePosition:p=Un,as:b="div",wrapperClass:P,pointerEvents:M="auto",...S},k)=>{const{gl:A,camera:j,scene:D,size:_,raycaster:T,events:$,viewport:Y}=U(),[W]=d.useState(()=>document.createElement(b)),q=d.useRef(),F=d.useRef(null),w=d.useRef(0),C=d.useRef([0,0]),x=d.useRef(null),R=d.useRef(null),O=(g==null?void 0:g.current)||$.connected||A.domElement.parentNode,H=d.useRef(null),L=d.useRef(!1),V=d.useMemo(()=>r&&r!=="blending"||Array.isArray(r)&&r.length&&Kn(r[0]),[r]);d.useLayoutEffect(()=>{const N=A.domElement;r&&r==="blending"?(N.style.zIndex=`${Math.floor(c[0]/2)}`,N.style.position="absolute",N.style.pointerEvents="none"):(N.style.zIndex=null,N.style.position=null,N.style.pointerEvents=null)},[r]),d.useLayoutEffect(()=>{if(F.current){const N=q.current=pn(W);if(D.updateMatrixWorld(),o)W.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const z=p(F.current,j,_);W.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${z[0]}px,${z[1]}px,0);transform-origin:0 0;`}return O&&(a?O.prepend(W):O.appendChild(W)),()=>{O&&O.removeChild(W),N.unmount()}}},[O,o]),d.useLayoutEffect(()=>{P&&(W.className=P)},[P]);const B=d.useMemo(()=>o?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:l?"translate3d(-50%,-50%,0)":"none",...h&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...n},[n,l,h,_,o]),re=d.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);d.useLayoutEffect(()=>{if(L.current=!1,o){var N;(N=q.current)==null||N.render(d.createElement("div",{ref:x,style:B},d.createElement("div",{ref:R,style:re},d.createElement("div",{ref:k,className:i,style:n,children:e}))))}else{var z;(z=q.current)==null||z.render(d.createElement("div",{ref:k,style:B,className:i,children:e}))}});const oe=d.useRef(!0);ge(N=>{if(F.current){j.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const z=o?C.current:p(F.current,j,_);if(o||Math.abs(w.current-j.zoom)>t||Math.abs(C.current[0]-z[0])>t||Math.abs(C.current[1]-z[1])>t){const Q=Gn(F.current,j);let Z=!1;V&&(r!=="blending"?Z=[D]:Array.isArray(r)&&(Z=r.map(ee=>ee.current)));const fe=oe.current;if(Z){const ee=qn(F.current,j,T,Z);oe.current=ee&&!Q}else oe.current=!Q;fe!==oe.current&&(u?u(!oe.current):W.style.display=oe.current?"block":"none");const be=Math.floor(c[0]/2),Rt=r?V?[c[0],be]:[be-1,0]:c;if(W.style.zIndex=`${Xn(F.current,j,Rt)}`,o){const[ee,Ye]=[_.width/2,_.height/2],Ce=j.projectionMatrix.elements[5]*Ye,{isOrthographicCamera:Ze,top:jt,left:At,bottom:Tt,right:kt}=j,Dt=Yn(j.matrixWorldInverse),Lt=Ze?`scale(${Ce})translate(${He(-(kt+At)/2)}px,${He((jt+Tt)/2)}px)`:`translateZ(${Ce}px)`;let te=F.current.matrixWorld;v&&(te=j.matrixWorldInverse.clone().transpose().copyPosition(te).scale(F.current.scale),te.elements[3]=te.elements[7]=te.elements[11]=0,te.elements[15]=1),W.style.width=_.width+"px",W.style.height=_.height+"px",W.style.perspective=Ze?"":`${Ce}px`,x.current&&R.current&&(x.current.style.transform=`${Lt}${Dt}translate(${ee}px,${Ye}px)`,R.current.style.transform=Zn(te,1/((s||10)/400)))}else{const ee=s===void 0?1:Vn(F.current,j)*s;W.style.transform=`translate3d(${z[0]}px,${z[1]}px,0) scale(${ee})`}C.current=z,w.current=j.zoom}}if(!V&&H.current&&!L.current)if(o){if(x.current){const z=x.current.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const{isOrthographicCamera:Q}=j;if(Q||y)S.scale&&(Array.isArray(S.scale)?S.scale instanceof G?H.current.scale.copy(S.scale.clone().divideScalar(1)):H.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):H.current.scale.setScalar(1/S.scale));else{const Z=(s||10)/400,fe=z.clientWidth*Z,be=z.clientHeight*Z;H.current.scale.set(fe,be,1)}L.current=!0}}}else{const z=W.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const Q=1/Y.factor,Z=z.clientWidth*Q,fe=z.clientHeight*Q;H.current.scale.set(Z,fe,1),L.current=!0}H.current.lookAt(N.camera.position)}});const Xe=d.useMemo(()=>({vertexShader:o?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[o]);return d.createElement("group",X({},S,{ref:F}),r&&!V&&d.createElement("mesh",{castShadow:f,receiveShadow:m,ref:H},y||d.createElement("planeGeometry",null),E||d.createElement("shaderMaterial",{side:en,vertexShader:Xe.vertexShader,fragmentShader:Xe.fragmentShader})))});let me=0;const gr=ut(e=>(we.onStart=(t,n,i)=>{e({active:!0,item:t,loaded:n,total:i,progress:(n-me)/(i-me)*100})},we.onLoad=()=>{e({active:!1})},we.onError=t=>e(n=>({errors:[...n.errors,t]})),we.onProgress=(t,n,i)=>{n===i&&(me=i),e({active:!0,item:t,loaded:n,total:i,progress:(n-me)/(i-me)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),it=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Ct(e,t){const n=U(a=>a.gl),i=J(Ne,it(e)?Object.values(e):e);if(d.useLayoutEffect(()=>{t==null||t(i)},[t]),d.useEffect(()=>{(Array.isArray(i)?i:[i]).forEach(n.initTexture)},[n,i]),it(e)){const a=Object.keys(e),l={};return a.forEach(h=>Object.assign(l,{[h]:i[a.indexOf(h)]})),l}else return i}Ct.preload=e=>J.preload(Ne,e);Ct.clear=e=>J.clear(Ne,e);function Jn(e){return Array.isArray(e)}function ze(e=[0,0,0]){return Jn(e)?e:e instanceof G||e instanceof ct?[e.x,e.y,e.z]:[e,e,e]}const yr=d.forwardRef(function({debug:t,mesh:n,children:i,position:a,rotation:l,scale:h,...g},s){const v=d.useRef(null);d.useImperativeHandle(s,()=>v.current);const o=d.useRef(null);return d.useLayoutEffect(()=>{const r=(n==null?void 0:n.current)||v.current.parent,u=v.current;if(!(r instanceof tn))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const f={position:new G,rotation:new ct,scale:new G(1,1,1)};if(r){K(f,{position:a,scale:h});const m=r.matrixWorld.clone();if(r.matrixWorld.identity(),!l||typeof l=="number"){const E=new nn;E.position.copy(f.position),E.lookAt(r.position),typeof l=="number"&&E.rotateZ(l),K(f,{rotation:E.rotation})}else K(f,{rotation:l});return u.geometry=new mn(r,f.position,f.rotation,f.scale),o.current&&K(o.current,f),r.matrixWorld=m,()=>{u.geometry.dispose()}}},[n,...ze(a),...ze(h),...ze(l)]),d.createElement("mesh",{ref:v},i||d.createElement("meshStandardMaterial",X({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},g)),t&&d.createElement("mesh",{ref:o},d.createElement("boxGeometry",null),d.createElement("meshNormalMaterial",{wireframe:!0}),d.createElement("axesHelper",null)))});let Pe=null;function St(e,t,n){return i=>{n&&n(i),e&&(Pe||(Pe=new vn),Pe.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(Pe)),t&&i.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}function Ot(e,t=!0,n=!0,i){return J(Ue,e,St(t,n,i))}Ot.preload=(e,t=!0,n=!0,i)=>J.preload(Ue,e,St(t,n,i));Ot.clear=e=>J.clear(Ue,e);const br=d.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:i,enableDamping:a=!0,onChange:l,onStart:h,onEnd:g,...s},v)=>{const o=U(M=>M.invalidate),r=U(M=>M.camera),u=U(M=>M.gl),f=U(M=>M.events),m=U(M=>M.setEvents),E=U(M=>M.set),y=U(M=>M.get),c=U(M=>M.performance),p=t||r,b=i||f.connected||u.domElement,P=d.useMemo(()=>new hn(p),[p]);return ge(()=>{P.enabled&&P.update()},-1),d.useEffect(()=>(P.connect(b),()=>void P.dispose()),[b,n,P,o]),d.useEffect(()=>{const M=A=>{o(),n&&c.regress(),l&&l(A)},S=A=>{h&&h(A)},k=A=>{g&&g(A)};return P.addEventListener("change",M),P.addEventListener("start",S),P.addEventListener("end",k),()=>{P.removeEventListener("start",S),P.removeEventListener("end",k),P.removeEventListener("change",M)}},[l,h,g,P,o,m]),d.useEffect(()=>{if(e){const M=y().controls;return E({controls:P}),()=>E({controls:M})}},[e,P]),d.createElement("primitive",X({ref:v,object:P,enableDamping:a},s))});class Qn extends rn{constructor(t){super(t),this.onBeforeCompile=(n,i)=>{const{isWebGL2:a}=i.capabilities;n.fragmentShader=n.fragmentShader.replace("#include <output_fragment>",`
        ${a?"#include <output_fragment>":`#extension GL_OES_standard_derivatives : enable
#include <output_fragment>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <encodings_fragment>
      `)}}}const wr=d.forwardRef((e,t)=>{const[n]=d.useState(()=>new Qn(null));return d.createElement("primitive",X({},e,{object:n,ref:t,attach:"material"}))}),_r=d.forwardRef(({children:e,enabled:t=!0,speed:n=1,rotationIntensity:i=1,floatIntensity:a=1,floatingRange:l=[-.1,.1],...h},g)=>{const s=d.useRef(null),v=d.useRef(Math.random()*1e4);return ge(o=>{var r,u;if(!t||n===0)return;const f=v.current+o.clock.getElapsedTime();s.current.rotation.x=Math.cos(f/4*n)/8*i,s.current.rotation.y=Math.sin(f/4*n)/8*i,s.current.rotation.z=Math.sin(f/4*n)/20*i;let m=Math.sin(f/4*n)/10;m=on.mapLinear(m,-.1,.1,(r=l==null?void 0:l[0])!==null&&r!==void 0?r:-.1,(u=l==null?void 0:l[1])!==null&&u!==void 0?u:.1),s.current.position.y=m*a,s.current.updateMatrix()}),d.createElement("group",h,d.createElement("group",{ref:Ge([s,g]),matrixAutoUpdate:!1},e))});let ne,ve;const er=d.createContext(null),st=new sn,at=new G,tr=d.forwardRef(({children:e,range:t,limit:n=1e3,...i},a)=>{const l=d.useRef(null),[h,g]=d.useState([]),[[s,v,o]]=d.useState(()=>[new Float32Array(n*3),Float32Array.from({length:n*3},()=>1),Float32Array.from({length:n},()=>1)]);d.useEffect(()=>{l.current.geometry.attributes.position.needsUpdate=!0}),ge(()=>{for(l.current.updateMatrix(),l.current.updateMatrixWorld(),st.copy(l.current.matrixWorld).invert(),l.current.geometry.drawRange.count=Math.min(n,t!==void 0?t:n,h.length),ne=0;ne<h.length;ne++)ve=h[ne].current,ve.getWorldPosition(at).applyMatrix4(st),at.toArray(s,ne*3),l.current.geometry.attributes.position.needsUpdate=!0,ve.matrixWorldNeedsUpdate=!0,ve.color.toArray(v,ne*3),l.current.geometry.attributes.color.needsUpdate=!0,o.set([ve.size],ne),l.current.geometry.attributes.size.needsUpdate=!0});const r=d.useMemo(()=>({getParent:()=>l,subscribe:u=>(g(f=>[...f,u]),()=>g(f=>f.filter(m=>m.current!==u.current)))}),[]);return d.createElement("points",X({userData:{instances:h},matrixAutoUpdate:!1,ref:Ge([a,l]),raycast:()=>null},i),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:ce}),d.createElement("bufferAttribute",{attach:"attributes-color",count:v.length/3,array:v,itemSize:3,usage:ce}),d.createElement("bufferAttribute",{attach:"attributes-size",count:o.length,array:o,itemSize:1,usage:ce})),d.createElement(er.Provider,{value:r},e))}),nr=d.forwardRef(({children:e,positions:t,colors:n,sizes:i,stride:a=3,...l},h)=>{const g=d.useRef(null);return ge(()=>{const s=g.current.geometry.attributes;s.position.needsUpdate=!0,n&&(s.color.needsUpdate=!0),i&&(s.size.needsUpdate=!0)}),d.createElement("points",X({ref:Ge([h,g])},l),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:ce}),n&&d.createElement("bufferAttribute",{attach:"attributes-color",count:n.length/a,array:n,itemSize:3,usage:ce}),i&&d.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/a,array:i,itemSize:1,usage:ce})),e)}),Er=d.forwardRef((e,t)=>e.positions instanceof Float32Array?d.createElement(nr,X({},e,{ref:t})):d.createElement(tr,X({},e,{ref:t})));function Pr({all:e,scene:t,camera:n}){const i=U(({gl:h})=>h),a=U(({camera:h})=>h),l=U(({scene:h})=>h);return d.useLayoutEffect(()=>{const h=[];e&&(t||l).traverse(v=>{v.visible===!1&&(h.push(v),v.visible=!0)}),i.compile(t||l,n||a);const g=new an(128);new ln(.01,1e5,g).update(i,t||l),g.dispose(),h.forEach(v=>v.visible=!1)},[]),null}export{vr as C,yr as D,_r as F,hr as H,br as O,Pr as P,Ot as a,Ct as b,ge as c,Er as d,wr as e,gr as u};
//# sourceMappingURL=@react-three-43fd1402.js.map
